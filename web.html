<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyCapoo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #87CEEB; /* 天空藍 */
            color: white;
            padding: 15px;
            text-align: center;
        }
        header img {
            width: 40px;
            vertical-align: middle;
            margin-right: 10px;
        }
        h1 {
            display: inline-block;
            font-size: 36px;
            margin: 0;
        }
        h2 {
            font-size: 24px;
            color: #333;
            margin-top: 10px;
        }
        .container {
            margin-top: 50px;
        }
        .input-group {
            margin: 10px auto;
            text-align: center;
            width: 300px;
        }
        .input-group label {
            font-size: 18px;
            margin-right: 10px;
            display: inline-block;
            width: 100px;
            text-align: right;
        }
        .input-group input {
            padding: 8px;
            font-size: 16px;
            width: 190px;
        }
        .button-group {
            margin-top: 20px;
        }
        .button-group button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50; /* 綠色 */
            color: white;
            border: none;
            cursor: pointer;
            margin: 10px;
        }
        .button-group button.stop {
            background-color: #f44336;
        }
        .button-group button:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>

<header>
    <img src="https://www.pnglog.com/7CSPjJ.png" alt="SkyCapoo Logo">
    <h1>SkyCapoo</h1>
    <h2>指定玩家循環邀請</h2>
</header>

<div class="container">
    <div class="input-group">
        <label for="miniuid">迷你號:</label>
        <input type="number" id="miniuid" value="1000">
    </div>
    <div class="input-group">
        <label for="inviter_name">邀請者名稱:</label>
        <input type="text" id="inviter_name" value="#RCAPOO">
    </div>
    <div class="input-group">
        <label for="room_name">房間名稱:</label>
        <input type="text" id="room_name" value="Capoooo">
    </div>
    <div class="input-group">
        <label for="max_players">最多人數:</label>
        <input type="number" id="max_players" value="6">
    </div>
    <div class="input-group">
        <label for="current_players">當前人數:</label>
        <input type="number" id="current_players" value="1">
    </div>

    <div class="button-group">
        <button id="startBtn">開始循環</button>
        <button id="stopBtn" class="stop" disabled>停止循環</button>
    </div>
</div>

<script>
    let intervalId;

    function to_base64(data) {
        const b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
        return btoa(data).replace(/.{4}/g, function(m) {
            return m + (b.indexOf(m.charAt(3)) !== -1 ? '' : '=');
        });
    }

    function url_encode(str) {
        return encodeURIComponent(str);
    }

    // 按下 "開始循環" 按鈕時觸發
    document.getElementById('startBtn').addEventListener('click', function() {
        let miniuid = Number(document.getElementById('miniuid').value);
        const inviter_name = document.getElementById('inviter_name').value;
        const room_name = document.getElementById('room_name').value;
        const max_players = Number(document.getElementById('max_players').value);
        const current_players = Number(document.getElementById('current_players').value);

        if (miniuid < 1000000000) {
            miniuid += 1000000000;
            alert("已確認迷你號: " + miniuid);
        }

        const json_data = JSON.stringify({
            InviterName: inviter_name,
            Password: "",
            PlayerMaxNum: max_players,
            PlayerNum: current_players,
            RoomId: 0,
            RoomName: room_name,
            RoomType: "Omekey_Rent_Room",
            RoomUin: 1000,
            RoomVer: 67343,
            Standby1: 11,
            Type: "InviteJoinRoomA",
            WorldID: 0
        });

        const base64_encoded = to_base64(json_data);
        const url_encoded = url_encode(base64_encoded);
        const msg = "%E6%88%BF%E9%96%93%E9%82%80%E8%AB%8B%E4%BF%A1%E6%81%AF";
        const host_url = "http://friend.miniworldgame.com:8180//server/friend";
        const params = `apiid=303&cmd=send_chat_msg&country=HK&des_uin=${miniuid}&extend_data=${url_encoded}&lang=2&msg=${msg}&show_type=1&src_uin=1300738565&ver=1.7.15&msgtype=3&pushchannel=1&s2t=1736348402&time=1736348472&uin=1300738565&token=38e5ddc3a9ba3219dcb12478673a8ae0&auth=eaaa5586221daf616fe04a084b404ca7`;

        // 開始循環請求
        intervalId = setInterval(function() {
            fetch(host_url + "?" + params, {
                method: 'GET',
                headers: nil
            });
        }, 1000); // 每秒執行一次
        document.getElementById('startBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;

        alert('循環開啟成功');
    });

    // 按下 "停止循環" 按鈕時觸發
    document.getElementById('stopBtn').addEventListener('click', function() {
        clearInterval(intervalId);
        document.getElementById('startBtn').disabled = false;
        document.getElementById('stopBtn').disabled = true;
        alert('循環關閉成功');
    });
</script>

</body>
</html>
